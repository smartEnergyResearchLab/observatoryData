---
title: "SERL data and documentation:  \nReadme"
output: 
  word_document:
    reference_doc: SERL_word_template_portrait1.docx
    toc: yes
references:
- id: serlWebsite
  title: Smart Energy Research Lab
  url: 'https://www.serl.ac.uk/'
---


```{r setup2, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# load relevant libraries
library(data.table)
library(ggplot2)
library(knitr)
library(captioner)
library(lubridate)
library(flextable)
library(officer)

source("N:/R/observatoryData/scripts/get.serl.filename.R")
source("N:/R/observatoryData/scripts/create.info.table.R")

```

```{r defineInputs, include = FALSE}

release_version <- "2020_08"
release_date <- "2020-08"
survey_version <- "01"

# onboarding and offboarding data

load_table_data <- FALSE # TRUE if we've run this file before and don't want to re-process the data (only edit the text, formatting, etc.)

location_processed <- "S:/ENERGINST_EaB_Project_17_SMRP/Data/Researcher data/Observatory2020_08/Processed/"
load(paste(location_processed, "DQ_input.RData", sep = ""))
load(paste(location_processed, "RData files/epc_stats.RData", sep = ""))

onboard_file <- "S:/ENERGINST_EaB_Project_17_SMRP/Data/Onboarding/Onboarding_Report_2020-08-27.csv"

# Define plotting/reporting variables for the markdown output
fig.h <- 6
fig.w <- 10
fullwidth <- TRUE
fig_caps <- captioner(prefix = "Figure")
tab_caps <- captioner(prefix = "Table")
font.size <- 18
geom.text.size <- 5

```

```{r functions, include = FALSE}

my.flex <- function(t, autofit = TRUE) {
  ft <- flextable(t)
  ft <- theme_booktabs(ft)
  ft <- theme_zebra(ft, 
                    odd_header = rgb(84/255, 141/255, 212/255, 1),
                    even_body = "transparent",
                    odd_body = rgb(242/255, 242/255, 242/255, 1))
  ft <- color(ft, color = "white", part = "header")
  ft <- italic(ft, italic = TRUE, part = "header")
  ft <- bold(ft, bold = FALSE, part = "header")
  if(autofit == TRUE) {
    ft <- autofit(ft)
  } else{
    ft <- set_table_properties(ft, width = 1, layout = "autofit")
  }
  return(ft)
}

add.simple.table.superscript <- function(flex_table,
                                         unit_1D = "m",
                                         power = "3",
                                         row_ids = c(1, 2),
                                         col_name = "Units",
                                         t_part = "body") {
  # puts superscript formatting in a flextable. E.g. with the
  #  defaults, we'd add m^3 (formatted) to rows 1 and 2 in
  #  column called units.
  
  formatted_table <- compose(
    flex_table,
    i = row_ids,
    j = col_name,
    part = t_part,
    value = as_paragraph(unit_1D,
                         as_sup(power))
  )
  
  return(formatted_table)
}
  

```

```{r keyNumbers, include = FALSE}

```

```{r docInfoTable, include = FALSE}
info_tab <- create.info.table()
```

```{r}
info_tab
```

```{r captions, include = FALSE}

tab_caps(name = "", 
         caption = "")

```

```{r participation, include = FALSE}

onboards <- fread(onboard_file)
participants <- onboards[Project == "SERL" & 
                           Trial_ID == "Wave1-Pilot" & 
                           DCC_inventory_response == "Valid" & 
                           Consent_end_date > as.Date(Consent_end_date)]

```

# Introduction

## Smart Energy Research Lab (SERL)

The [Smart Energy Research Lab](https://www.serl.ac.uk) (SERL) will provide a secure, consistent and trusted channel for researchers to access high-resolution energy data, which will facilitate innovative energy research for years to come. SERL is [funded](https://gow.epsrc.ukri.org/NGBOViewGrant.aspx?GrantRef=EP/P032761/1) by the UK's Engineering and Physical Sciences Research Council (EPSRC) and comprises a [consortium](https://serl.ac.uk/about-who-we-are/) of seven UK universities and the Energy Saving Trust.

Our initial work programme focuses on:

* establishing a Smart Energy Observatory of ~10,000 smart metered households across Great Britain (GB);

* developing a mechanism for other researchers to access smart meter data for other household samples from whom they have obtained informed consent.

## Participant recruitment

Participant recruitment began in August 2019. Approximately 1700 participants were recruited from central and southern England adn from Wales as part of a pilot study that tested different recruitment strategies. The second recruitment wave takes place in August-September 2020, and the third wave at the end of 2020. SERL aims to recruit 8-10,000 households to be regionally representative across England, Scotland and Wales. Recruitment is also designed to be representative of each Index of Multiple Deprivation (IMD) quintile; an area-based relative measure of deprivation. 



# 2020-08 SERL Observatory dataset

This document accompanies the 2020-08 release of the SERL Observatory dataset. This is the first Observatory dataset release and is available in a secure virtual environment to UK-based accredited researchers working on approved projects (see below for more details on data access). Smart meter data collection start dates vary by participant; the earliest start date is August 2018. This data release contains all data available up until 31st July 2020. Future data releases will include more recent data and data from participants recruited in the second and third recruitment waves. 

The datasets can be linked at the household level using the "PUPRN" pseudo-anonymous identifier included in each dataset. The climate data can be linked through the "grid_cell" provided with the participant summary (smart meter) dataset. 


## Smart meter data

In order to participate a household must have a DCC-enrolled electricity smart meter (SMETS2 or upgraded SMETS1). In GB smart meters collect electricity and (mains) gas data at 30-minute resolution. If a household has embedded generation such as solar PV, the electricity readings show the net demand for each half-hour (always non-negative) and separate readings show net export (always non-negative). Reactive power data is also available. In addition to the half-hourly data, daily reads are also provided, which can be used for data quality checking, or enhanced by the half-hourly reads if daily reads are missing. 

Currently `r n_d_p` participants have daily smart meter reads in the datset and `r n_hh_p` have half-hourly reads in the dataset. `r n_no_gas` participants do not have a gas meter (that we are able to access). 

### Data files

There are four data files relating to smart meter data:

* _`r paste(get.serl.filename("daily_data", release_version) , ".csv", sep = "")`:_ daily electricity and gas readings with some additional derived columns;

* _`r paste(get.serl.filename("hh_data", release_version) , ".csv", sep = "")`:_ half-hourly electricity and gas readings with some additional derived columns (note that this dataset also includes reactive readings and export readings where available);

* _`r paste(get.serl.filename("rt_data", release_version) , ".csv", sep = "")`:_ data quality summary for each read type for each participant (such as number of errors found by type) and basic read statistics (such as mean and maximum);

* _`r paste(get.serl.filename("ps_data", release_version) , ".csv", sep = "")`:_ data quality summary for each participant (less detail than the read-type summary data, but also including basic participant information such as region and number of questions answered on the survey).

### Documentation

There are documents accompanying the smart meter data:

* _`r paste(get.serl.filename("sm_doc", release_version), ".pdf", sep = "")`:_ smart meter documentation describing the four datasets, the fields and details about derived variables;

* _`r paste(get.serl.filename("sm_dq_report", release_version), ".pdf", sep = "")`:_ smart meter data quality report summarising various data statistics, data availability, and the prevalence of missing and potentially erroneous reads.


### Code

The R code used to process the raw half-hourly and daily datasets (creating the four datasets outlined above) is available with this data release. All code and documentation is (or will shortly be) available on the [SERL GitHub site](https://github.com/smartEnergyResearchLab) which will contain the most up-to-date versions of all non-disclosive files. The code file is

* _`r paste(get.serl.filename("sm_code", release_version), ".R", sep = "")`_


## Survey data

When they sign up participants are encouraged to complete a survey about their household and dwelling. It is not compulsory but most participants complete the survey. The survey is completed online or on a postal form. Each asks the same questions and response options, and the data are provided together, with a variable indicating the response mode. The online survey has the advantage of automatic question routing and basic answer checking (e.g. flagging up the wrong input type). 

### Data file

The survey data provided with this release relates to the participants who were recruited during the first recruitment wave in 2019. The file is

* _`r paste(get.serl.filename("survey_data", release_version), ".csv", sep = "")`_ 


### Documentation

Two documents accompany the survey data:

* _`r paste(get.serl.filename("survey_doc", survey_version), ".pdf", sep = "")`:_ documentation for the survey data, summarising the responses to each question and comparing the results with national surveys where possible, commenting on evidence of bias;

* _`r paste(get.serl.filename("survey_questions", survey_version), ".pdf", sep = "")`:_ postal survey sent with some of the mailings/reminders (same questions and options as the online survey).

### Code

The R code used to process the raw survey data will be made available on the [SERL GitHub](https://github.com/smartEnergyResearchLab) observatoryData repository.


## Energy Performance Certificate (EPC) data

If available, each household's Energy Performance Certificate (EPC) is also provided (the most recent is used). There are currently `r nrow_epc` households with an EPC. 

### Data file

The EPC dataset is:

* _`r paste(get.serl.filename("epc_data", release_version), ".csv", sep = "")`_


### Documentation

The EPC data documentation details all fields included in the dataset and gives information about the values included.

* _`r paste(get.serl.filename("epc_doc", release_version), ".pdf", sep = "")`_


### Code
After address identifiers were removed and replaced by our PUPRN pseudo-identifiers no further processing was performed, therefore there is no code available for this dataset. 



## Climate data

Climate reanalysis data is also provided for each household. The data from the Copernicus/ECMWF [ERA5 hourly reanalysis data](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview). More variables will be provided in future releases, but at the moment only temperature at 2 metres is part of the data. It can be linked with SERL participants using the 'gridCell' variable.

This is reanalysis data based on recorded data from many weather stations across GB, at a horizontal resolution of 0.25 x 0.25 degrees latitute and longitude (approximately 28 sq. km). More information about spacial resolution is available [here](https://confluence.ecmwf.int/display/CKB/ERA5%3A+What+is+the+spatial+reference). ERA5 documentation is available [here](https://confluence.ecmwf.int/display/CKB/ERA5%3A+data+documentation).

### Data file

The climate dataset:

* _`r paste(get.serl.filename("climate_data", release_version), ".csv", sep = "")`_

### Documentation

Documentation describing the dataset and the fields available is given in the file:

* _`r paste(get.serl.filename("climate_doc", release_version), ".pdf", sep = "")`_


### Code
No processing has been done on the data so this datset does not have associated code. 



# Data access

Access to the SERL Observatory datasets is provided via a secure lab environment and is restricted to accredited researchers working on approved projects. This aligns with the [5 Safes](https://www.ukdataservice.ac.uk/manage-data/legal-ethical/access-control/five-safes) protocols used by the UK Data Service (UKDS) for all access to any controlled data via a secure lab. Currently, SERL only provides controlled datasets via a secure lab environment.

The process to obtain access to controlled data is appropriately rigorous so it is strongly recommended that researchers read the detailed documentation associated with the SERL catalogue record ([SN 8666](https://beta.ukdataservice.ac.uk/datacatalogue/studies/study?id=8666)) in the UKDS data catalogue to ensure that SERL data is appropriate for your research project before any other steps.

Summary of steps and rough timelines:

1. Accredited Researcher status (safe Researcher training and exam): _1 month_
2. University Ethics approval: this varies by institution but allow at least _3-4 weeks_
3. Project application (UKDS triage and SERL Data Governance Board review): _4-6 weeks_

Therefore, if starting from scratch, it is recommended that researchers allow at least 3 months for completion of the above processes before access to the data is required.

Full details are available here: [Accessing SERL Observatory data – information for researchers (PDF)](https://serl.ac.uk/wp-content/uploads/2020/08/Accessing-SERL-Observatory-data-info-for-researchers-v04.pdf)

The [Accessing SERL data](https://serl.ac.uk/researchers/) page on the SERL website has more information for researchers including a set of FAQs. 


# Participation over time




```{r saving, include = FALSE}
# if(load_table_data == FALSE) {
#   save(
#     read.type.tab,
#     hh.cols.tab,
#     d.cols.tab,
#     sched.tab,
#     partic.tab,
#     first_read_date_hh,
#     last_read_date_hh,
#     n_hh_p,
#     nrow_hh,
#     ncol_hh,
#     first_read_date_d,
#     last_read_date_d,
#     n_d_p,
#     nrow_d,
#     ncol_d,
#     nrow_reads,
#     ncol_reads,
#     nrow_pp,
#     ncol_pp,
#     file = paste(saving_location, "sm_data_documentation_input.RData", sep = "")
#   )
# }
```

